<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafito Image Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: linear-gradient(to bottom right, #fef7cd, #fed7aa);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .image-container {
            width: 100%;
            height: 200px;
            background: linear-gradient(to bottom right, #f59e0b, #ea580c);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .status {
            margin-top: 10px;
            font-size: 14px;
        }
        .success { color: #059669; }
        .error { color: #dc2626; }
        .loading { color: #7c3aed; }
        h1 {
            color: #92400e;
            text-align: center;
        }
        .stats {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Cafito Menu Images Test</h1>
        
        <div class="stats">
            <div id="stats">Loading menu data...</div>
        </div>
        
        <div id="imageGrid" class="image-grid">
            <!-- Images will be loaded here -->
        </div>
    </div>

    <script>
        let imageCount = 0;
        let loadedCount = 0;
        let errorCount = 0;

        function updateStats() {
            const stats = document.getElementById('stats');
            stats.innerHTML = `
                üìä <strong>Image Loading Status:</strong><br>
                Total: ${imageCount} | 
                ‚úÖ Loaded: ${loadedCount} | 
                ‚ùå Failed: ${errorCount} | 
                ‚è≥ Loading: ${imageCount - loadedCount - errorCount}
            `;
        }

        function createImageCard(item) {
            const card = document.createElement('div');
            card.className = 'image-card';
            
            card.innerHTML = `
                <div class="image-container">
                    <img id="img-${item.id}" alt="${item.name}" style="display: none;">
                </div>
                <h3>${item.name}</h3>
                <p><small>${item.name_ar}</small></p>
                <div class="status loading" id="status-${item.id}">üîÑ Loading...</div>
            `;
            
            const img = card.querySelector('img');
            const status = card.querySelector(`#status-${item.id}`);
            
            img.onload = function() {
                console.log('‚úÖ Loaded:', item.name);
                img.style.display = 'block';
                status.className = 'status success';
                status.innerHTML = `‚úÖ Loaded (${this.naturalWidth}√ó${this.naturalHeight})`;
                loadedCount++;
                updateStats();
            };
            
            img.onerror = function() {
                console.error('‚ùå Failed:', item.name, item.image_url);
                status.className = 'status error';
                status.innerHTML = '‚ùå Failed to load';
                errorCount++;
                updateStats();
            };
            
            // Test fetch first
            fetch(item.image_url, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        console.log('üì° Fetch OK for:', item.name);
                        img.src = item.image_url;
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                })
                .catch(error => {
                    console.error('üì° Fetch failed for:', item.name, error);
                    status.className = 'status error';
                    status.innerHTML = `‚ùå Fetch failed: ${error.message}`;
                    errorCount++;
                    updateStats();
                });
            
            return card;
        }

        // Load menu data from API
        fetch('http://localhost:8001/api/menu')
            .then(response => response.json())
            .then(data => {
                console.log('üìä Menu data loaded:', data.length, 'items');
                imageCount = data.length;
                updateStats();
                
                const grid = document.getElementById('imageGrid');
                
                data.forEach(item => {
                    if (item.image_url) {
                        const card = createImageCard(item);
                        grid.appendChild(card);
                    } else {
                        console.warn('‚ö†Ô∏è No image URL for:', item.name);
                    }
                });
                
                if (data.filter(item => item.image_url).length === 0) {
                    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #dc2626;">‚ùå No items with image URLs found!</div>';
                }
            })
            .catch(error => {
                console.error('‚ùå Failed to load menu:', error);
                document.getElementById('stats').innerHTML = '‚ùå Failed to load menu data: ' + error.message;
            });
    </script>
</body>
</html>